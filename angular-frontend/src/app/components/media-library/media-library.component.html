<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="mb-0">
          <i class="bi bi-collection-play"></i> Media Library
        </h4>
        <div class="d-flex gap-2">
          <button class="btn btn-primary btn-sm" (click)="refreshMedia()">
            <i class="bi bi-arrow-clockwise"></i> Refresh
          </button>
          <div class="dropdown">
            <button class="btn btn-outline-secondary btn-sm dropdown-toggle" 
                    type="button" data-bs-toggle="dropdown">
              Filter by Device
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" (click)="filterByDevice('')">All Devices</a></li>
              <li *ngFor="let device of uniqueDevices">
                <a class="dropdown-item" href="#" (click)="filterByDevice(device)">
                  {{ device }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="card-body">
        <!-- Tabs for Videos and Screenshots -->
        <ul class="nav nav-tabs mb-4" id="mediaTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" [class.active]="selectedTab==='videos'" type="button" role="tab" (click)="setTab('videos')">
              <i class="bi bi-play-circle"></i> Videos ({{ filteredVideos.length }})
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" [class.active]="selectedTab==='screenshots'" type="button" role="tab" (click)="setTab('screenshots')">
              <i class="bi bi-camera"></i> Screenshots ({{ filteredScreenshots.length }})
            </button>
          </li>
        </ul>
        
        <div class="tab-content" id="mediaTabContent">
          <!-- Videos Tab -->
          <div class="tab-pane fade" [class.show]="selectedTab==='videos'" [class.active]="selectedTab==='videos'" id="videos" role="tabpanel">
            <div *ngIf="filteredVideos.length === 0" class="text-center py-5">
              <i class="bi bi-play-circle display-1 text-muted"></i>
              <h4 class="mt-3 text-muted">No videos found</h4>
              <p class="text-muted">Start recording from the camera page to see videos here.</p>
            </div>
            
            <div class="row g-3" *ngIf="filteredVideos.length > 0">
              <div class="col-lg-4 col-md-6" *ngFor="let video of filteredVideos">
                <div class="card h-100">
                  <div class="video-wrapper">
                    <video class="card-img-top video-thumbnail" controls preload="metadata">
                      <source [src]="getVideoUrl(video.fileName)" type="video/webm">
                      Your browser does not support the video tag.
                    </video>
                  </div>
                  <div class="card-body">
                    <h6 class="card-title">{{ video.fileName }}</h6>
                    <div class="media-info">
                      <small class="text-muted d-block">
                        <i class="bi bi-device-ssd"></i> Device: {{ video.deviceId }}
                      </small>
                      <small class="text-muted d-block">
                        <i class="bi bi-calendar"></i> {{ video.recordedAt | date:'medium' }}
                      </small>
                      <small class="text-muted d-block">
                        <i class="bi bi-file-earmark"></i> {{ formatFileSize(video.fileSize) }}
                      </small>
                      <small class="text-muted d-block" *ngIf="video.duration">
                        <i class="bi bi-clock"></i> {{ formatDuration(video.duration) }}
                      </small>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="d-flex gap-2">
                      <a [href]="getVideoUrl(video.fileName)" download class="btn btn-primary btn-sm action-btn">
                        <i class="bi bi-download"></i> Download
                      </a>
                      <button class="btn btn-danger btn-sm action-btn" (click)="confirmDeleteVideo(video)">
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Screenshots Tab -->
          <div class="tab-pane fade" [class.show]="selectedTab==='screenshots'" [class.active]="selectedTab==='screenshots'" id="screenshots" role="tabpanel">
            <div *ngIf="filteredScreenshots.length === 0" class="text-center py-5">
              <i class="bi bi-camera display-1 text-muted"></i>
              <h4 class="mt-3 text-muted">No screenshots found</h4>
              <p class="text-muted">Take screenshots from the camera page to see them here.</p>
            </div>
            
            <div class="row g-3" *ngIf="filteredScreenshots.length > 0">
              <div class="col-lg-3 col-md-4 col-sm-6" *ngFor="let screenshot of filteredScreenshots">
                <div class="card h-100">
                  <div class="image-wrapper">
                    <img [src]="getScreenshotUrl(screenshot.fileName)" 
                         class="card-img-top screenshot-thumbnail"
                         [alt]="screenshot.fileName"
                         (click)="openImageModal(screenshot)">
                  </div>
                  <div class="card-body p-2">
                    <h6 class="card-title small">{{ screenshot.fileName }}</h6>
                    <div class="media-info">
                      <small class="text-muted d-block">
                        <i class="bi bi-device-ssd"></i> {{ screenshot.deviceId }}
                      </small>
                      <small class="text-muted d-block">
                        <i class="bi bi-calendar"></i> {{ screenshot.capturedAt | date:'short' }}
                      </small>
                      <small class="text-muted d-block">
                        <i class="bi bi-file-earmark"></i> {{ formatFileSize(screenshot.fileSize) }}
                      </small>
                      <small class="text-muted d-block" *ngIf="screenshot.width && screenshot.height">
                        <i class="bi bi-aspect-ratio"></i> {{ screenshot.width }}x{{ screenshot.height }}
                      </small>
                    </div>
                  </div>
                  <div class="card-footer p-2">
                    <div class="d-flex gap-2">
                      <a [href]="getScreenshotUrl(screenshot.fileName)" download class="btn btn-primary btn-sm action-btn">
                        <i class="bi bi-download"></i> Download
                      </a>
                      <button class="btn btn-danger btn-sm action-btn" (click)="confirmDeleteScreenshot(screenshot)">
                        <i class="bi bi-trash"></i> Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" *ngIf="selectedImage">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ selectedImage.fileName }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-center">
        <img [src]="getScreenshotUrl(selectedImage.fileName)" 
             class="img-fluid" 
             [alt]="selectedImage.fileName">
        <div class="mt-3">
          <p class="text-muted">
            Device: {{ selectedImage.deviceId }} | 
            Captured: {{ selectedImage.capturedAt | date:'medium' }} |
            Size: {{ formatFileSize(selectedImage.fileSize) }}
          </p>
        </div>
      </div>
      <div class="modal-footer">
        <a [href]="getScreenshotUrl(selectedImage.fileName)" 
           download 
           class="btn btn-primary">
          <i class="bi bi-download"></i> Download
        </a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>